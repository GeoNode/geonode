{% load i18n %}

<div class="modal fade" id="modal_perms" style="display:none">
  <form id="permission_form" accept-charset="UTF-8" method="post" class="modal-form" action="{{ form_action|default:"" }}">
    <div class="modal-header">
      <a class="close" data-dismiss="modal">Ã—</a>
      <h3>{% trans "Permissions" %}</h3>
    </div>
    <div class="modal-body">
      <div class="control-group">
        <label class="control-label"><strong>{% trans "Who can view and download this data?" %}</strong></label>
        <div class="controls">
          <label class="radio inline">
            <input type="radio" name="viewmode" id="perms_view" value="ANYONE">
            {% trans "Anyone" %}
          </label>
          <label class="radio inline">
            <input type="radio" name="viewmode" id="perms_view2" value="REGISTERED">
            {% trans "Any registered user" %}
          </label>
          <label class="radio inline">
            <input type="radio" name="viewmode" id="perms_view3" value="EDITORS">
            {% trans "Only users who can edit" %}
          </label>
        </div>
      </div>
      <div class="control-group">
        <label class="control-label"><strong>{% trans "Who can edit this data?" %}</strong></label>
        <div class="controls">
          <label class="radio">
            <input type="radio" name="editmode" id="perms_edit1" value="REGISTERED">
            {% trans "Any registered user" %}
          </label>
          <label class="radio">
            <input type="radio" name="editmode" id="perms_edit2" value="LIST">
            {% trans "Only the following users or groups:" %}
          </label>
          <input name="editusers" class="user-select" data-placeholder="{% trans "Choose a user or group..." %}">
          </input>
        </div>
      </div>
      <div class="control-group">
        <label class="control-label"><strong>{% trans "Who can manage and edit this data?" %}</strong></label>
        <div class="controls">
          <input name="manageusers" class="user-select" data-placeholder="{% trans "Choose a user or group..." %}">
          </input>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#" class="btn" data-dismiss="modal">{% trans "Cancel" %}</a>
      <a href="#" class="btn btn-primary" data-dismiss="modal" id="perms_submit">{% trans "Apply Changes" %}</a>
    </div>
  </form>
  <script type="text/javascript">
    $(function() {
      $("input.user-select").select2({
        placeholder: {title: '{% trans "Add User..." %}', id: ""},
        minimumInputLength: 1,
        multiple: true,
        ajax: {
          url: "{% url auth_ajax_lookup %}",
          dataType: "json",
          type: "POST",
          data: function (term, page) {
            return {
              query: term,
            };
          },
          results: function (data, page) {
            return {results: data.users};
          }
        },
        id: userID,
        formatResult: userFormatResult,
        formatSelection: userFormatSelection
      });

      function userID(user) {
        return user.username
      }

      function userFormatResult(user) {
        return user.username
      }

      function userFormatSelection(user) {
          return user.username;
      }

      var toggle_buttons = function() {
        if ($("input.asset-selector:checked").length) {
          $(".asset-modifier").removeClass("disabled");
        } else {
          $(".asset-modifier").addClass("disabled");
        }
      };

      $("input.asset-selector").live("change", toggle_buttons);
      toggle_buttons();
    });
    </script>
</div>
