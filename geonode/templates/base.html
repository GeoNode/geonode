{% load i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{% block title %}{{ SITENAME }}{% endblock %}</title>
    {% block head %}
      <link href="{{ STATIC_URL }}geonode/css/ext-compatibility.css" rel="stylesheet" />
      <link href="{{ STATIC_URL }}geonode/css/datatables.css" rel="stylesheet" />
      <link href="{{ STATIC_URL }}geonode/css/base.css" rel="stylesheet" />
      <link href="{{ STATIC_URL }}geonode/select2/select2.css" rel="stylesheet"/>
      <script src="{{ STATIC_URL }}geonode/js/cssrefresh.js" type="text/javascript"></script>
      {% block extra_head %}{% endblock %}
    {% endblock %}
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="{% block body_class %}{% endblock %}">
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="row">
            <div class="span3">
              <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
              <a href="{% url home %}">
                <span class="nav-logo">
                  <a class="brand">{{ SITENAME }}</a>
                </span>
              </a>
            </div>
            <div class="span6">
                <form class="form-inline well search-box" action="{% url search %}" method="POST">
                  {% csrf_token %}
                  <input type="text" class="input-medium" name="q" placeholder="Search" />
                  <select name="" id="" class="span2">
                    <option value="">All Categories</option>
                    <option value="">Category 1</option>
                    <option value="">Category 2</option>
                  </select>
                  <button type="submit" class="btn btn-small"><i class="icon-search"></i></button>
                  <a href="{% url advanced_search %}">{% trans "Advanced Search" %}</a>
                </form>
            </div>
            <div class="span3">
              <div class="nav-collapse">
                <div class="pull-right">
                  <p class="navbar-text pull-left"><a href="{% url help %}">{% trans "Help" %}</a>&nbsp;|&nbsp;
                  {% if user.is_authenticated %}
                    {% trans "Logged in as:" %}
                  {% endif %}
                  </p>
                  <ul class="nav pull-right">
                    {% if user.is_authenticated %}
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                          {{ user.username }}
                          <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                          <li><a href="{% if user.get_profile %}{{ user.get_profile.get_absolute_url }}{% else %}{% url profiles_create_profile %}{% endif %}"><i class="icon-user"></i> {% trans "Profile" %}</a></li>
                          {% if user.is_staff %}
                            <li><a href="{% url admin:index %}"><i class="icon-cog"></i> {% trans "Admin" %}</a></li>
                          {% endif %}
                          <li class="divider"></li>
                          <li><a href="{% url auth_logout %}"><i class="icon-off"></i> {% trans "Log out" %}</a></li>
                        </ul>
                      </li>
                    {% else %}
                        <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans "Sign in" %}</a>
                          <ul class="dropdown-menu">
                            <li>
                                <form action="" class="sign-in">
                                    <label for="">Username:</label>
                                    <input type="text" />
                                    <label for="">Password:</label>
                                    <input type="password" />
                                    <label class="checkbox">
                                        <input type="checkbox" />
                                        Remember me
                                    </label>
                                    <button type="submit" class="btn pull-right">Sign In</button>
                                    <div>Don't have an account yet? <a href="#">Register now</a></div>
                                </form>
                            </li>
                          </ul>
                        </li>
                        {% if REGISTRATION_OPEN %}
                          <li class="navbar-text">{% trans "or" %}</li>
                          <li><a href="{% url registration_register %}">{% trans "Register" %}</a></li>
                        {% endif %}
                    {% endif %}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="content-wrap">
    <div class="container">
      <div class="row nav-box">
        <div class="span10">
          <nav class="main-nav">
            <ul>
              <li>
                <a href="{% url home %}">{% trans "Home" %}</a>
              </li>
              <li>
                <a href="{% url layer_browse %}">{% trans "Explore Data" %}</a>
              </li>
              <li>
                <a href="{% url upload %}">{% trans "Upload Data" %}</a>
              </li>
              <li>
                <a href="{% url maps_browse %}">{% trans "Explore Maps" %}</a>
              </li>
              <li>
                <a href="{% url new_map %}" class="last">{% trans "Create a New Map" %}</a>
              </li>
            </ul>
          </nav>
        </div>
        <div class="span2">
          <ul class="social">
            <li><a href="#" class="fb">facebook</a></li>
            <li><a href="#" class="tw">twitter</a></li>
            <li><a href="#" class="gp">google+</a></li>
          </ul>
        </div>
      </div>
      <div class="row">
        {% block body_outer %}
          <div class="span8">
            {% block main %}{% endblock %}
          </div>
          <div class="span4">
            {% block sidebar %}{% endblock %}
          </div>
        {% endblock %}
      </div>
    </div>
    </div>
    <footer class="footer">
      <div class="container">
        {% block footer %}
          <div class="pull-left">
            {% trans "Powered by" %} <a href="http://geonode.org">{% trans "GeoNode" %}</a> |
            <strong>{% trans "Need Help?" %}</strong>
            <a href="{% url help %}">{% trans "Help" %}</a> |
            <a href="{% url dev %}">{% trans "For Developers" %}</a>
          </div>
          <div class="pull-right">
            {% if csrf_token != "NOTPROVIDED" %}
              {% get_current_language as LANGUAGE %}
              <form class="form-inline" action="/i18n/setlang/" method="post">
                {% csrf_token %}
                <label>{% trans "Language" %}</label>
                <select class="input span2" name="language" onchange="javascript:form.submit()">
                  {% for lang in LANGUAGES %}
                    <option value="{{ lang.0 }}" {% ifequal LANGUAGE_CODE lang.0 %} selected="selected"{% endifequal %}>
                      {{ lang.1 }}
                    </option>
                  {% endfor %}
                </select>
              </form>
            {% endif %}
          </div>
        {% endblock %}
      </div>
    </footer>

    <script src="{{ STATIC_URL }}bootstrap/js/jquery-1.7.1.min.js"></script>
    <script src="{{ STATIC_URL }}bootstrap/js/bootstrap.min.js"></script>

    <script src="{{ STATIC_URL }}geonode/select2/select2.js"></script>
    <script type="text/javascript">

      $(function() {

        jQuery(document).ajaxSend(function(event, xhr, settings) {
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            function sameOrigin(url) {
                // url could be relative or scheme relative or absolute
                var host = document.location.host; // host + port
                var protocol = document.location.protocol;
                var sr_origin = '//' + host;
                var origin = protocol + sr_origin;
                // Allow absolute or scheme relative URLs to same origin
                return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
                    (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
                    // or any other URL that isn't scheme relative or absolute i.e relative.
                    !(/^(\/\/|http:|https:).*/.test(url));
            }
            function safeMethod(method) {
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        });


        $("input.user-select").select2({
          placeholder: {title: '{% trans "Add User..." %}', id: ""},
          minimumInputLength: 1,
          multiple: true,
          ajax: {
            url: "{% url auth_ajax_lookup %}",
            dataType: "json",
            type: "POST",
            data: function (term, page) {
              return {
                query: term,
              };
            },
            results: function (data, page) {
              return {results: data.users};
            }
          },
          id: userID,
          formatResult: userFormatResult,
          formatSelection: userFormatSelection
        });

        function userID(user) {
          return user.username
        }

        function userFormatResult(user) {
          return user.username
        }

        function userFormatSelection(user) {
            return user.username;
        }
      });
    </script>

    {% block extra_script %}{% endblock extra_script %}

    <script type="text/javascript" src="{% url django.views.i18n.javascript_catalog %}"></script>
    <script type="text/javascript" src="{% url lang %}"></script>
  </body>
</html>
