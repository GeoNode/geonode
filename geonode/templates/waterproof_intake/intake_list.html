{% extends "geonode_base.html" %} {% load i18n %} {% block title %}{% trans "Water Intakes" %}{% endblock %} 
 
{% load i18n %} 
{% load static from staticfiles %}
{% load bootstrap_tags %} 
<h1>{% trans "Water Intakes" %}</h1>

{% block extra_head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
    <link rel="stylesheet" href="http://xguaita.github.io/Leaflet.MapCenterCoord/dist/L.Control.MapCenterCoord.min.css" />
    <link rel="stylesheet" href="https://photon.komoot.io/static/leaflet.photon/leaflet.photon.css"></link>


{% endblock %} {% block body_outer %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/dataTables.bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/waterproof_nbs_ca.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
<div class="row">
    <div class="col-md-4">
        <h4 class="text-center" id="countryLabel">{{country.name}}</h4>
        <p><b>Region:</b> <span id="regionLabel">{{region.name}}</span> </p>
        <p><b>Currency:</b><span id="currencyLabel">({{currency.code}}) - {{currency.name}}</span></p>
    </div>
    <div class="col-md-8">
        <div id="map" style="width: 700px; height: 200px;"></div>

    </div>
</div>
<div class="page-header">
   
    <h1>{% trans "List Water Intake" %}</h1>
    <a href="create/" id="createUrl">{% trans "Create new Water Intake" %}</a>
</div>
<div class="table-responsive">
    <table id="example" class="table table-striped table-bordered table-condensed" style="width:100%">
        <thead>
            <tr class="info">
                <th scope="col" class="small text-center vat">{% trans "Name" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Description" %}</th>
                <th scope="col" class="small text-center vat">{% trans "User" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Date" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Demand" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Options" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for sbn in intake %}
            <tr>
                <td class="small text-center vat">{{sbn.name}}</td>
                <td class="small text-center vat">{{sbn.description}}</td>
                <td class="small text-center vat">{{sbn.added_by.first_name}} {{sbn.added_by.last_name}}</td>
                <!--td>{{sbn.max_benefit_req_time}}</td-->
                <td class="small text-center vat">Navidad</td>
                <!--td>{{sbn.total_profits_sbn_consec_time}}</td-->
                <!--td class="small text-center vat">{{sbn.creation_date}}</td>
                <!td class="small text-center vat">{{sbn.unit_maintenance_cost|floatformat:2}}</td>
                <td class="small text-center vat">{{sbn.periodicity_maitenance}}</td>
                <td class="small text-center vat">{{sbn.unit_oportunity_cost|floatformat:2}}</td-->
                <!--td>{{sbn.rios_transformations.description}}</td-->
                <td>
                    <div class="btn-group btn-group-table" role="group">
                        <a class="btn btn-primary" href="/waterproof_nbs_ca/view/{{sbn.pk}}"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></a>
                     </div> 
                </td>  
                <td>
                    <div class="btn-group btn-group-table" role="group">
                        <a class="btn btn-primary" href="/waterproof_nbs_ca/view/{{sbn.pk}}"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></a>
                        {% if user.is_authenticated %}
                            {% if user.professional_role == 'ADMIN' %}
                            <a class="btn btn-info" href="/waterproof_nbs_ca/edit/{{sbn.pk}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                            <a class="btn btn-warning" href="/waterproof_nbs_ca/clone/{{sbn.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
                            <a class="btn btn-danger" href="/waterproof_nbs_ca/delete/{{sbn.pk}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                            {% endif %}
                            {% if user.professional_role == 'ANAL' %}
                                {% if sbn.added_by.pk == user.pk %}
                                <a class="btn btn-info" href="/waterproof_nbs_ca/edit/{{sbn.pk}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                <a class="btn btn-warning" href="/waterproof_nbs_ca/clone/{{sbn.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
                                <a class="btn btn-danger" href="/waterproof_nbs_ca/delete/{{sbn.pk}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                                {% else %}
                                <a class="btn btn-warning" href="/waterproof_nbs_ca/clone/{{sbn.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </div>

                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% block body %}{% endblock body %} {% block sidebar %}{% endblock sidebar %} {% endblock body_outer %} {% block extra_script %}
<script>
    var countriesLayerUrl = '{{ STATIC_URL }}waterproof_nbs_ca/data/countries.geojson';
    var userCountryId='{{userCountry.id}}';
    var userCountryCode='{{userCountry.code}}';
    var userCountryName='{{userCountry.name}}';
</script>
<script src="{{ STATIC_URL }}geonode/js/datatables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet.ajax.min.js"></script>
<script src="{{ STATIC_URL }}waterproof_intake/js/intake_list.js"></script>



<script src="https://vinceg.github.io/twitter-bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
  <script src="https://vinceg.github.io/twitter-bootstrap-wizard/prettify.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
  <script src="https://www.zimmi.cz/Leaflet-Coordinates-Control/Control.Coordinates.js"></script>
  <script src="http://xguaita.github.io/Leaflet.MapCenterCoord/dist/L.Control.MapCenterCoord.min.js"></script>
  <script src="{% static "geonode/js/leaflet/photon/leaflet.photon.js" %}"></script>
  
  <script type="text/javascript">
    API_URL = '/proxy/?url=https://photon.komoot.de/api/?';
    TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    CENTER = [-74.4879, 4.582];
    MAXZOOM = 11;

    let waterproof = {};

    $(document).ready(function () {
        
        //var map = L.map('map').setView([4, -74],5);
        //var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        //    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        //});
        //map.addLayer(osm);
        
        var map = L.map('map', {scrollWheelZoom: false, zoomControl: false, photonControl: true, photonControlOptions: {resultsHandler: showWaterIntakes, placeholder: 'Search water intake', position: 'topright', url: API_URL}});
        map.setView([4, -74],5);
        searchPoints.addTo(map);
        var tilelayer = L.tileLayer(TILELAYER, {maxZoom: MAXZOOM, attribution: 'Data \u00a9 <a href="http://www.openstreetmap.org/copyright"> OpenStreetMap Contributors </a> Tiles \u00a9 Komoot'}).addTo(map);
        var zoomControl = new L.Control.Zoom({position: 'topleft'}).addTo(map);

        var c = new L.Control.Coordinates();
        L.control.mapCenterCoord().addTo(map);
		  c.addTo(map);

        function onMapClick(e) {
            c.setCoordinates(e);      
        }
        map.on('click', onMapClick);
      
    });    

    var searchPoints = L.geoJson(null, {
        onEachFeature: function (feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });

    function showWaterIntakes (geojson) {
        searchPoints.clearLayers();
        let geojsonFilter = geojson.features.filter(feature  => feature.properties.type == "city");
        searchPoints.addData(geojsonFilter);
    }
    
  </script>  
{% endblock %}