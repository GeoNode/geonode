{% extends "maps/map_base.html" %}
{% load i18n %}
{% load maps_tags %}
{% load pagination_tags %}
{% load staticfiles %}
{% load url from future %}

{% block body_class %}maps explore{% endblock %}

{% block body %}
  <div class="span8">
    <h2 class="page-title">{% trans "Explore Maps" %}</h2>
    {% include "maps/_map_filters.html" %}
  </div>
  <div class="span4">
    <p><a href="{% url "new_map" %}" class="btn btn-large pull-right strong">{% trans "Create a New Map" %}</a></p>
    
  </div>
  <div class="span12">
    <div class="row">
      <div class="tabs-left span4">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#all" data-toggle="tab">All Categories <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat1" data-toggle="tab">Category 1 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat2" data-toggle="tab">Category 2 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat3" data-toggle="tab">Category 3 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat4" data-toggle="tab">Category 4 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat5" data-toggle="tab">Category 5 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat6" data-toggle="tab">Category 6 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat7" data-toggle="tab">Category 7 <i class="icon-chevron-right pull-right"></i></a></li>
          <li><a href="#cat8" data-toggle="tab">Category 8 <i class="icon-chevron-right pull-right"></i></a></li>
        </ul>
      </div>
      <div class="tab-content">
        <div class="tab-pane active span8 grid" id="all">
          <div class="row">
            {% featured_maps as featured_maps %}
            {% autopaginate featured_maps 8 %}
            {% for map in featured_maps %}
              {% include "maps/_map_grid_item.html" %}
            {% endfor %}
          </div>
        </div>
      </div>
      <div>
        {% paginate %}
      </div>
    </div>
  </div>

{% endblock %}

{% block extra_script %}
  <script src="{% static "geonode/js/bootstrap-tab.js" %}" type="text/javascript"></script>
  <script src="{% static "agon_ratings/js/jquery.raty.js" %}"></script>
  <script type="text/javascript">
     $(function() {
       $('.overall_rating').each(function() {
        var rating = $(this).parents(".avg_rating").data('rating');
        star(this, rating);
      });
       $(".tab-pane").on("load.loadmore", function(e, o) {          
        o.find(".overall_rating").each(function() {
          var rating = $(this).parents(".avg_rating").data('rating');
          star(this, rating);
        });
       });
     });
      function star(elem, rating) {
          $(elem).raty({
            half: true,
           readOnly: true,
           score: rating,
           path: "{% static "agon_ratings/img/" %}"
          });        
      }
  </script>
{% endblock %}

