L.Control.Opacity=L.Control.extend({options:{collapsed:false,position:"topright",label:null},initialize:function(c,a){L.Util.setOptions(this,a);this._layerControlInputs=[];this._layers=[];this._lastZIndex=0;this._handlingClick=false;for(var b in c){this._addLayer(c[b],b,true)}},onAdd:function(a){this._initLayout();this._update();return this._container},expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");this._form.style.height=null;var a=this._map.getSize().y-(this._container.offsetTop+50);if(a<this._form.clientHeight){L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar");this._form.style.height=a+"px"}else{L.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar")}return this},collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded");return this},_initLayout:function(){var c="leaflet-control-layers",b=this._container=L.DomUtil.create("div",c),f=this.options.collapsed;b.setAttribute("aria-haspopup",true);L.DomEvent.disableClickPropagation(b);L.DomEvent.disableScrollPropagation(b);if(this.options.label){var a=L.DomUtil.create("p",c+"-label");a.innerHTML=this.options.label;b.appendChild(a)}var e=this._form=L.DomUtil.create("form",c+"-list");if(f){this._map.on("click zoom move",this.collapse,this);if(!L.Browser.android){L.DomEvent.on(b,{mouseenter:this.expand,mouseleave:this.collapse},this)}}var d=this._layersLink=L.DomUtil.create("a",c+"-toggle",b);d.href="#";d.title="Layers";if(L.Browser.touch){L.DomEvent.on(d,"click",L.DomEvent.stop);L.DomEvent.on(d,"click",this.expand,this)}else{L.DomEvent.on(d,"focus",this.expand,this)}if(!f){this.expand()}this._baseLayersList=L.DomUtil.create("div",c+"-base",e);this._separator=L.DomUtil.create("div",c+"-separator",e);this._overlaysList=L.DomUtil.create("div",c+"-overlays",e);b.appendChild(e)},_getLayer:function(b){for(var a=0;a<this._layers.length;a++){if(this._layers[a]&&L.Util.stamp(this._layers[a].layer)===b){return this._layers[a]}}},_addLayer:function(c,b,a){this._layers.push({layer:c,name:b,overlay:a})},_update:function(){if(!this._container){return this}L.DomUtil.empty(this._baseLayersList);L.DomUtil.empty(this._overlaysList);this._layerControlInputs=[];var a,d,c,e,b=0;for(c=0;c<this._layers.length;c++){e=this._layers[c];this._addItem(e);d=d||e.overlay;a=a||!e.overlay;b+=!e.overlay?1:0}if(this.options.hideSingleBase){a=a&&b>1;this._baseLayersList.style.display=a?"":"none"}this._separator.style.display=d&&a?"":"none";return this},_addItem:function(f){var d=document.createElement("label"),b;if(f.overlay){b=document.createElement("input");b.type="range";b.className="leaflet-control-layers-range";b.min=0;b.max=100;b.value=f.layer.options.opacity*100}else{b=this._createRadioElement("leaflet-base-layers",checked)}this._layerControlInputs.push(b);b.layerId=L.Util.stamp(f.layer);L.DomEvent.on(b,"click",this._onInputClick,this);L.DomEvent.on(b,"touchend",this._onInputClick,this);var c=document.createElement("span");c.innerHTML=" "+f.name;var e=document.createElement("div");var g=document.createElement("div");d.appendChild(e);e.appendChild(c);d.appendChild(g);g.appendChild(b);var a=f.overlay?this._overlaysList:this._baseLayersList;a.appendChild(d);return d},_onInputClick:function(){var a=this._layerControlInputs,b,d;this._handlingClick=true;for(var c=a.length-1;c>=0;c--){b=a[c];d=this._getLayer(b.layerId).layer;if(typeof d._url==="undefined"){}else{d.setOpacity(b.value/100)}}this._handlingClick=false;this._refocusOnMap()}});L.control.opacity=function(b,a){return new L.Control.Opacity(b,a)};