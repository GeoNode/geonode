/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.1 (2020-05-27)
 */
!function(f){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(){return(u=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};var n,r,e,o=function(){},a=function(t){return function(){return t}},i=function(t){return t},c=a(!1),s=a(!0),l=function(){return d},d=(n=function(t){return t.isNone()},{fold:function(t,n){return t()},is:c,isSome:c,isNone:s,getOr:e=function(t){return t},getOrThunk:r=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(undefined),or:e,orThunk:r,map:l,each:o,bind:l,exists:c,forall:s,filter:l,equals:n,equals_:n,toArray:function(){return[]},toString:a("none()")}),m=function(r){var t=a(r),n=function(){return o},e=function(t){return t(r)},o={fold:function(t,n){return n(r)},is:function(t){return r===t},isSome:s,isNone:c,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return m(t(r))},each:function(t){t(r)},bind:e,exists:e,forall:e,filter:function(t){return t(r)?o:d},toArray:function(){return[r]},toString:function(){return"some("+r+")"},equals:function(t){return t.is(r)},equals_:function(t,n){return t.fold(c,function(t){return n(r,t)})}};return o},y={some:m,none:l,from:function(t){return null===t||t===undefined?d:m(t)}},g=function(e){return function(t){return r=typeof(n=t),(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r)===e;var n,r}},p=g("string"),h=g("object"),v=g("array"),b=Array.prototype.slice,k=Array.prototype.indexOf,O=function(t,n){return r=t,e=n,-1<k.call(r,e);var r,e},w=function(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var a=t[o];e[o]=n(a,o)}return e},C=function(t,n){for(var r=0,e=t.length;r<e;r++){n(t[r],r)}},E=function(t,n){for(var r=[],e=0,o=t.length;e<o;e++){var a=t[e];n(a,e)&&r.push(a)}return r},x=function(t,n,r){return function(t,n){for(var r=t.length-1;0<=r;r--){n(t[r],r)}}(t,function(t){r=n(r,t)}),r},R=function(t,n){return function(t,n,r){for(var e=0,o=t.length;e<o;e++){var a=t[e];if(n(a,e))return y.some(a);if(r(a,e))break}return y.none()}(t,n,c)},T=function(t,n){for(var r=0,e=t.length;r<e;++r){if(!0!==n(t[r],r))return!1}return!0},N=Object.keys,P=Object.hasOwnProperty,S=function(t,n){return P.call(t,n)},M=(function(i){if(!v(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var u=[],r={};C(i,function(t,e){var n=N(t);if(1!==n.length)throw new Error("one and only one name per case");var o=n[0],a=t[o];if(r[o]!==undefined)throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!v(a))throw new Error("case arguments must be an array");u.push(o),r[o]=function(){var t=arguments.length;if(t!==a.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+a.length+" ("+a+"), got "+t);for(var r=new Array(t),n=0;n<r.length;n++)r[n]=arguments[n];return{fold:function(){if(arguments.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+arguments.length);return arguments[e].apply(null,r)},match:function(t){var n=N(t);if(u.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+n.join(","));if(!T(u,function(t){return O(n,t)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+u.join(", "));return t[o].apply(null,r)},log:function(t){f.console.log(t,{constructors:u,constructor:o,params:r})}}}})}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(t){var n=[],r=[];return C(t,function(t){t.fold(function(t){n.push(t)},function(t){r.push(t)})}),{errors:n,values:r}}),A=function(r){return{is:function(t){return r===t},isValue:s,isError:c,getOr:a(r),getOrThunk:a(r),getOrDie:a(r),or:function(t){return A(r)},orThunk:function(t){return A(r)},fold:function(t,n){return n(r)},map:function(t){return A(t(r))},mapError:function(t){return A(r)},each:function(t){t(r)},bind:function(t){return t(r)},exists:function(t){return t(r)},forall:function(t){return t(r)},toOption:function(){return y.some(r)}}},B=function(r){return{is:c,isValue:c,isError:s,getOr:i,getOrThunk:function(t){return t()},getOrDie:function(){return t=String(r),function(){throw new Error(t)}();var t},or:function(t){return t},orThunk:function(t){return t()},fold:function(t,n){return t(r)},map:function(t){return B(r)},mapError:function(t){return B(t(r))},each:o,bind:function(t){return B(r)},exists:c,forall:s,toOption:y.none}},D={value:A,error:B,fromOption:function(t,n){return t.fold(function(){return B(n)},A)}},I=function(t){return"inline-command"===t.type||"inline-format"===t.type},j=function(t){return"block-command"===t.type||"block-format"===t.type},_=function(t){return n=t,r=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(e=b.call(n,0)).sort(r),e;var n,r,e},U=function(o){var a=function(t){return D.error({message:t,pattern:o})},t=function(t,n,r){if(o.format===undefined)return o.cmd!==undefined?p(o.cmd)?D.value(r(o.cmd,o.value)):a(t+" pattern has non-string `cmd` parameter"):a(t+" pattern is missing both `format` and `cmd` parameters");var e=void 0;if(v(o.format)){if(!T(o.format,p))return a(t+" pattern has non-string items in the `format` array");e=o.format}else{if(!p(o.format))return a(t+" pattern has non-string `format` parameter");e=[o.format]}return D.value(n(e))};if(!h(o))return a("Raw pattern is not an object");if(!p(o.start))return a("Raw pattern is missing `start` parameter");if(o.end===undefined)return o.replacement!==undefined?p(o.replacement)?0===o.start.length?a("Replacement pattern has empty `start` parameter"):D.value({type:"inline-command",start:"",end:o.start,cmd:"mceInsertContent",value:o.replacement}):a("Replacement pattern has non-string `replacement` parameter"):0===o.start.length?a("Block pattern has empty `start` parameter"):t("Block",function(t){return{type:"block-format",start:o.start,format:t[0]}},function(t,n){return{type:"block-command",start:o.start,cmd:t,value:n}});if(!p(o.end))return a("Inline pattern has non-string `end` parameter");if(0===o.start.length&&0===o.end.length)return a("Inline pattern has empty `start` and `end` parameters");var r=o.start,e=o.end;return 0===e.length&&(e=r,r=""),t("Inline",function(t){return{type:"inline-format",start:r,end:e,format:t}},function(t,n){return{type:"inline-command",start:r,end:e,cmd:t,value:n}})},q=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},L=function(t){return{inlinePatterns:E(t,I),blockPatterns:_(E(t,j))}},V=function(e){return{setPatterns:function(t){var n=M(w(t,U));if(0<n.errors.length){var r=n.errors[0];throw new Error(r.message+":\n"+JSON.stringify(r.pattern,null,2))}e.set(L(n.values))},getPatterns:function(){return function f(){for(var t=0,n=0,r=arguments.length;n<r;n++)t+=arguments[n].length;var e=Array(t),o=0;for(n=0;n<r;n++)for(var a=arguments[n],i=0,u=a.length;i<u;i++,o++)e[o]=a[i];return e}(w(e.get().inlinePatterns,q),w(e.get().blockPatterns,q))}}},W="undefined"!=typeof f.window?f.window:Function("return this;")(),F=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=W.console;r&&(r.error?r.error.apply(r,t):r.log.apply(r,t))},G=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],H=function(t){var n,r,e=(S(n=t,r="textpattern_patterns")?y.from(n[r]):y.none()).getOr(G);if(!v(e))return F("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};var o=M(w(e,U));return C(o.errors,function(t){return F(t.message,t.pattern)}),L(o.values)},J=function(t){var n=t.getParam("forced_root_block","p");return!1===n?"":!0===n?"p":n},K=tinymce.util.Tools.resolve("tinymce.util.Delay"),X=tinymce.util.Tools.resolve("tinymce.util.VK"),z=tinymce.util.Tools.resolve("tinymce.util.Tools"),Q=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Y=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),Z=function(t,n){return{container:t,offset:n}},$=function(t){return t.nodeType===f.Node.TEXT_NODE},tt=function(t,n,r){if(n&&t.isEmpty(n)&&!r(n)){var e=n.parentNode;t.remove(n),tt(t,e,r)}},nt=function(t,n,r,e){void 0===e&&(e=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),e&&!r(n.startContainer)&&($(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),$(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),tt(t,o,r),o!==a&&tt(t,a,r))},rt=function(t,n){var r,e=n.get(t);return v(e)&&(0===(r=e).length?y.none():y.some(r[0])).exists(function(t){return S(t,"block")})},et=function(t){return 0===t.start.length},ot=function(t,n){var r=y.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===J(t)?r.orThunk(function(){return y.some(t.getBody())}):r},at=Q.DOM,it=function(n){return function(t){return n===t?-1:0}},ut=function(t,n,r){if($(t)&&0<=n)return y.some(Z(t,n));var e=Y(at);return y.from(e.backwards(t,n,it(t),r)).map(function(t){return Z(t.container,t.container.data.length)})},ft=function(t,r,e){if(!$(t))return y.none();var n=t.textContent;if(0<=r&&r<=n.length)return y.some(Z(t,r));var o=Y(at);return y.from(o.backwards(t,r,it(t),e)).bind(function(t){var n=t.container.data;return ft(t.container,r+n.length,e)})},ct=function(t,n,r){if(!$(t))return y.none();var e=t.textContent;if(n<=e.length)return y.some(Z(t,n));var o=Y(at);return y.from(o.forwards(t,n,it(t),r)).bind(function(t){return ct(t.container,n-e.length,r)})},st=function(t,n,r,e,o){var a,i=Y(t,(a=t,function(t){return a.isBlock(t)||O(["BR","IMG","HR","INPUT"],t.nodeName)||"false"===a.getContentEditable(t)}));return y.from(i.backwards(n,r,e,o))},lt=function(t,n,r){if($(n)&&(r<0||r>n.data.length))return[];for(var e=[r],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){e.push(i);break}o=a}return o===t?e.reverse():[]},dt=function(t,n,r,e,o){return{start:lt(t,n,r),end:lt(t,e,o)}},mt=function(t,n){var r,e,o,a=n.slice(),i=a.pop();return r=a,e=function(t,n){return t.bind(function(t){return y.from(t.childNodes[n])})},o=y.some(t),C(r,function(t){o=e(o,t)}),o.bind(function(t){return $(t)&&0<=i&&t.data.length,y.some({node:t,offset:i})})},gt=function(n,r){return mt(n,r.start).bind(function(t){var o=t.node,a=t.offset;return mt(n,r.end).map(function(t){var n=t.node,r=t.offset,e=f.document.createRange();return e.setStart(o,a),e.setEnd(n,r),e})})},pt=function(e,o,n){(function(t,n,r){if($(t)&&n>=t.length)return y.some(Z(t,n));var e=Y(at);return y.from(e.forwards(t,n,it(t),r)).map(function(t){return Z(t.container,0)})})(o,0,o).each(function(t){var r=t.container;ct(r,n.start.length,o).each(function(t){var n=e.createRng();n.setStart(r,0),n.setEnd(t.container,t.offset),nt(e,n,function(t){return t===o})})})},ht=function(e,a){var i=e.dom,t=e.selection.getRng();return ot(e,t).filter(function(t){var n=J(e),r=""===n&&i.is(t,"body")||i.is(t,n);return null!==t&&r}).bind(function(n){var t,r,e,o=n.textContent;return(t=a,e=(r=o).replace("\xa0"," "),R(t,function(t){return 0===r.indexOf(t.start)||0===e.indexOf(t.start)})).map(function(t){return z.trim(o).length===t.start.length?[]:[{pattern:t,range:dt(i.getRoot(),n,0,n,0)}]})}).getOr([])},vt=function(i,t){if(0!==t.length){var n=i.selection.getBookmark();C(t,function(t){return r=t,e=(n=i).dom,o=r.pattern,a=gt(e.getRoot(),r.range).getOrDie("Unable to resolve path range"),ot(n,a).each(function(t){"block-format"===o.type?rt(o.format,n.formatter)&&n.undoManager.transact(function(){pt(n.dom,t,o),n.formatter.apply(o.format)}):"block-command"===o.type&&n.undoManager.transact(function(){pt(n.dom,t,o),n.execCommand(o.cmd,!1,o.value)})}),1;var n,r,e,o,a}),i.selection.moveToBookmark(n)}},yt=0,bt=function(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})},kt=function(t,n){var r=t.createRng();return r.setStartAfter(n.start),r.setEndBefore(n.end),r},Ot=function(t,n,r){var e=gt(t.getRoot(),r).getOrDie("Unable to resolve path range"),o=e.startContainer,a=e.endContainer,i=0===e.endOffset?a:a.splitText(e.endOffset),u=0===e.startOffset?o:o.splitText(e.startOffset);return{prefix:n,end:i.parentNode.insertBefore(bt(t,n+"-end"),i),start:u.parentNode.insertBefore(bt(t,n+"-start"),u)}},wt=function(t,n,r){tt(t,t.get(n.prefix+"-end"),r),tt(t,t.get(n.prefix+"-start"),r)},Ct=function(e,o,a,t){var i,u=o.start;return st(e,t.container,t.offset,(i=u,function(t,n){var r=t.data.substring(0,n),e=r.lastIndexOf(i.charAt(i.length-1)),o=r.lastIndexOf(i);return-1!==o?o+i.length:-1!==e?e+1:-1}),a).bind(function(r){if(r.offset>=u.length){var t=e.createRng();return t.setStart(r.container,r.offset-u.length),t.setEnd(r.container,r.offset),y.some(t)}var n=r.offset-u.length;return ft(r.container,n,a).map(function(t){var n=e.createRng();return n.setStart(t.container,t.offset),n.setEnd(r.container,r.offset),n}).filter(function(t){return t.toString()===u}).orThunk(function(){return Ct(e,o,a,Z(r.container,0))})})},Et=function(a,i,u){var f=a.dom,c=f.getRoot(),s=u.pattern,l=u.position.container,d=u.position.offset;return ft(l,d-u.pattern.end.length,i).bind(function(t){var e=dt(c,t.container,t.offset,l,d);if(et(s))return y.some({matches:[{pattern:s,startRng:e,endRng:e}],position:t});var n=xt(a,u.remainingPatterns,t.container,t.offset,i),o=n.getOr({matches:[],position:t}),r=o.position;return function(t,r,n,e,o,a){if(void 0===a&&(a=!1),0!==r.start.length||a)return ut(n,e,o).bind(function(n){return Ct(t,r,o,n).bind(function(t){if(a){if(t.endContainer===n.container&&t.endOffset===n.offset)return y.none();if(0===n.offset&&t.endContainer.textContent.length===t.endOffset)return y.none()}return y.some(t)})});var i=t.createRng();return i.setStart(n,e),i.setEnd(n,e),y.some(i)}(f,s,r.container,r.offset,i,n.isNone()).map(function(t){var n,r=dt(c,(n=t).startContainer,n.startOffset,n.endContainer,n.endOffset);return{matches:o.matches.concat([{pattern:s,startRng:r,endRng:e}]),position:Z(t.startContainer,t.startOffset)}})})},xt=function(d,m,g,p,h){var v=d.dom;return ut(g,p,v.getRoot()).bind(function(t){var n=v.createRng();n.setStart(h,0),n.setEnd(g,p);for(var r,e,o,a,i,u=n.toString(),f=0;f<m.length;f++){var c=m[f];if(r=u,e=c.end,i=a=o=void 0,a=e,i=(o=r).length-e.length,""===a||o.length>=a.length&&o.substr(i,i+a.length)===a){var s=m.slice();s.splice(f,1);var l=Et(d,h,{pattern:c,remainingPatterns:s,position:t});if(l.isSome())return l}}return y.none()})},Rt=function(n,t,r){n.selection.setRng(r),"inline-format"===t.type?C(t.format,function(t){n.formatter.apply(t)}):n.execCommand(t.cmd,!1,t.value)},Tt=function(o,t){var n,r,a=(n="mce_textpattern",r=(new Date).getTime(),n+"_"+Math.floor(1e9*Math.random())+ ++yt+String(r)),i=x(t,function(t,n){var r=Ot(o,a+"_end"+t.length,n.endRng);return t.concat([u(u({},n),{endMarker:r})])},[]);return x(i,function(t,n){var r=i.length-t.length-1,e=et(n.pattern)?n.endMarker:Ot(o,a+"_start"+r,n.startRng);return t.concat([u(u({},n),{startMarker:e})])},[])},Nt=function(r,e,o){var a=r.selection.getRng();return!1===a.collapsed?[]:ot(r,a).bind(function(t){var n=a.startOffset-(o?1:0);return xt(r,e,a.startContainer,n,t)}).fold(function(){return[]},function(t){return t.matches})},Pt=function(f,t){if(0!==t.length){var c=f.dom,n=f.selection.getBookmark(),r=Tt(c,t);C(r,function(t){var n,r,e,o,a,i=c.getParent(t.startMarker.start,c.isBlock),u=function(t){return t===i};et(t.pattern)?(n=f,r=t.pattern,e=t.endMarker,o=u,a=kt(n.dom,e),nt(n.dom,a,o),Rt(n,r,a)):function(t,n,r,e,o){var a=t.dom,i=kt(a,e),u=kt(a,r);nt(a,u,o),nt(a,i,o);var f={prefix:r.prefix,start:r.end,end:e.start},c=kt(a,f);Rt(t,n,c)}(f,t.pattern,t.startMarker,t.endMarker,u),wt(c,t.endMarker,u),wt(c,t.startMarker,u)}),f.selection.moveToBookmark(n)}},St=function(t,n){var r=Nt(t,n.inlinePatterns,!0);0<r.length&&t.undoManager.transact(function(){Pt(t,r)})},Mt=function(t,n,r){for(var e=0;e<t.length;e++)if(r(t[e],n))return!0},At=function(n,r){var e=[",",".",";",":","!","?"],o=[32];n.on("keydown",function(t){13!==t.keyCode||X.modifierPressed(t)||!function(r,t){if(!r.selection.isCollapsed())return!1;var e=Nt(r,t.inlinePatterns,!1),o=ht(r,t.blockPatterns);return(0<o.length||0<e.length)&&(r.undoManager.add(),r.undoManager.extra(function(){r.execCommand("mceInsertNewLine")},function(){r.insertContent("\ufeff"),Pt(r,e),vt(r,o);var t=r.selection.getRng(),n=ut(t.startContainer,t.startOffset,r.dom.getRoot());r.execCommand("mceInsertNewLine"),n.each(function(t){var n=t.container;"\ufeff"===n.data.charAt(t.offset-1)&&(n.deleteData(t.offset-1,1),tt(r.dom,n.parentNode,function(t){return t===r.dom.getRoot()}))})}),!0)}(n,r.get())||t.preventDefault()},!0),n.on("keyup",function(t){Mt(o,t,function(t,n){return t===n.keyCode&&!1===X.modifierPressed(n)})&&St(n,r.get())}),n.on("keypress",function(t){Mt(e,t,function(t,n){return t.charCodeAt(0)===n.charCode})&&K.setEditorTimeout(n,function(){St(n,r.get())})})};!function Bt(){t.add("textpattern",function(t){var n,r,e=(n=H(t.settings),r=n,{get:function(){return r},set:function(t){r=t}});return At(t,e),V(e)})}()}(window);