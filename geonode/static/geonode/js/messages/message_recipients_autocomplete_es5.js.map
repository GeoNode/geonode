{"version":3,"sources":["message_recipients_autocomplete.js"],"names":["get_users_data","data","objects","map","elem","value","username","id","get_groups_data","title","MessageRecipientsTags","input","data_extract_func","url","blacklist","tagName","type","Error","tagify","request_controller","Tagify","whitelist","on","_onInputHandler","bind","AbortController","event","detail","settings","length","loading","dropdown","hide","call","abort","fetch","signal","then","response","json","res","filter","includes","splice","show","JSON","parse","forEach","$","attr","name","appendTo","disabled"],"mappings":"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","sourcesContent":["function get_users_data(data) {\n    return data.objects.map((elem) => {\n        return {value: elem.username, id: elem.id};\n    });\n}\n\nfunction get_groups_data(data) {\n    return data.objects.map((elem) => {\n        return {value: elem.title, id: elem.id};\n    });\n}\n\nclass MessageRecipientsTags {\n    constructor(input, data_extract_func, url, blacklist = []) {\n        if (input.tagName !== 'INPUT' || input.type !== 'text') {\n            throw Error('Base element should be <input type=\"text\">');\n        }\n        this.input = input;\n        this.tagify = null;\n        this.data_extract_func = data_extract_func;\n        this.url = url;\n        this.blacklist = blacklist;\n        this.request_controller = null;\n    }\n\n    init() {\n        this.tagify = new Tagify(this.input, {whitelist: [], blacklist: this.blacklist});\n        this.tagify.on('input', this._onInputHandler.bind(this));\n        this.request_controller = new AbortController();\n    }\n\n\n    _onInputHandler(event) {\n        const value = event.detail.value;\n        this.tagify.settings.whitelist.length = 0;\n\n        this.tagify.loading(true).dropdown.hide.call(this.tagify);\n        this.request_controller.abort();\n        this.request_controller = new AbortController();\n\n        fetch(this.url + value, {signal:this.request_controller.signal}).then(response =>\n            response.json()\n                .then(this.data_extract_func)\n                .then(res => {\n                    res = res.filter(elem => {\n                        if (!(this.blacklist.includes(elem.value))) {\n                            return elem;\n                        }\n                    });\n                    this.tagify.settings.whitelist.splice(0, res.length, ...res);\n                    this.tagify.loading(false).dropdown.show.call(this.tagify, value);\n                }));\n    }\n\n    fixOutputValue() {\n        if (this.input.value !== '') {\n            JSON.parse(this.input.value).filter(elem => 'id' in elem).forEach((elem) => {\n                $('<input>').attr({\n                    type: 'hidden',\n                    id: 'foo',\n                    name: this.input.name,\n                    value: elem.id\n                }).appendTo('form');\n            });\n        }\n        this.input.disabled = true;\n    }\n}\n\n"],"file":"message_recipients_autocomplete_es5.js"}