{% extends "layers/layer_base.html" %}
{% load bootstrap_tags %}
{% load base_tags %}
{% load i18n %}
{% load i18n announcements_tags %}
{% announcements as site_wide_announcements %}
{% block title %} {% trans "Dashboard" %} - {{ block.super }} {% endblock %}
{% block extra_head %}
<link href="{{ STATIC_URL }}geonode/css/style-index.css?v={{ VERSION }}" rel="stylesheet" />
<link href="{{ STATIC_URL }}geonode/css/style.css?v={{ VERSION }}" rel="stylesheet" />
{% endblock %}
{% block middle %}
    <div id="gd-dashboard">
        <div class="container-fluid">
            <div class="gd-content">
                <div class="gd-content-heading">
                  <div class="row">
                      <div class="col-md-6">
                          <div class="title small-content">
                              {% trans "Dashboard" %}
                          </div>
                      </div>
                      <div class="col-md-6">
                          <div class="small-content text-right">
                                <a href="{% url "favourite_list" %}" class="btn btn-gd-primary pull-right icon-btn-color" >
                                    {% trans "View Favorites" %} <i class="fa fa-heart-o"></i>
                                </a>
                          </div>
                      </div>
                  </div>
                  <div class="row" style="padding-bottom:20px;">
                      <div class="col-md-6">
                          <div class="" style="">
                              <ul class="nav navbar-nav nav-pills">
                                  <li class="active"><a href="#layers-dashboard" id="layers_dashboard" data-toggle="tab" data-target="#layers-dashboard" ><i class="fa fa-square-o rotate-45"></i> {% trans "Layers" %}</a></li>
                                  <li><a href="#maps-dashboard" id="maps_dashboard" data-toggle="tab" data-target="#maps-dashboard"><i class="fa fa-square-o rotate-45"></i> {% trans "Maps" %}</a></li>
                                  <li ><a href="#documents-dashboard" id="documents_dashboard" data-target="#documents-dashboard" data-toggle="tab"><i class="fa fa-square-o rotate-45"></i> {% trans "Documents" %}</a></li>
                                  <li><a href="#orgs-dashboard" id="orgs_dashboard" data-target="#orgs-dashboard" data-toggle="tab"><i class="fa fa-square-o rotate-45"></i>  {% trans "Organizations" %}</a></li>
                              </ul>
                          </div>
                      </div>
                      <div class="col-md-6">
                          <div class="pull-right">
                              <ul class="search-type">
                                  <li>
                                      <a href="{% url "_dashboard" %}" title="List View">
                                          <i class="fa fa-bars fa-stack-1-5x"></i>
                                      </a>
                                  </li>
                                  <li>
                                      <a href="{% url "_dashboard_grid" %}" title="Tab View">
                                          <i class="fa fa-th-large fa-stack-1-5x"></i>
                                      </a>
                                  </li>
                                  <!--<li style="margin-top:-4px;">-->
                                      <!--<span style="font-size:20px;">{% trans "Docked" %}</span>-->
                                  <!--</li>-->
                                  <!--<li style="margin-top:-4px; padding-left:10px;">-->
                                      <!--<span style="font-size:20px;" id="total_layers-fav"></span>-->
                                  <!--</li>-->
                              </ul>
                          </div>
                      </div>
                  </div>
                  <div class="hr"></div>
                </div>
                <div class="gd-content-body transparent top-bottom-margin-20px">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="gd-content-body1 full-pad-40px1">
                              <div id="gd-featurd-maps" >
                                    <div class="container-fluid">
                                        <div class="gd-stastic">
                                            <div class="gd-featurd-maps-content-dash" >
                                                <div class="tab-content activity-style-list">
                                                    <article id="layers-dashboard" class="tab-pane active">
                                                        <div id="dash-layer-fav" style="background:#f4f8fb">

                                                        </div>
                                                    </article>
                                                    <article id="maps-dashboard" class="tab-pane active">
                                                        <div id="dash-maps-fav" style="background:#f4f8fb">

                                                        </div>
                                                    </article>
                                                    <article id="documents-dashboard" class="tab-pane active">
                                                        <div id="dash-documents-fav" style="background:#f4f8fb">

                                                        </div>
                                                    </article>
                                                    <article id="orgs-dashboard" class="tab-pane active">
                                                        <div id="dash-org-fav" style="background:#f4f8fb">

                                                        </div>
                                                    </article>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<article id="maps-dashboard" class="tab-pane">-->
                <!--<div class="gd-content-body transparent top-bottom-margin-20px tab-pane">-->
                    <!--<div class="row">-->
                        <!--<div class="col-md-12">-->
                            <!--<div class="gd-content-body1 full-pad-40px1">-->
                              <!--<div id="gd-featurd-maps" style="background:#fff;">-->
                                    <!--<div class="container">-->
                                        <!--<div class="gd-stastic">-->
                                            <!--<div class="gd-featurd-maps-content-dash">-->
                                                <!--<div id="dash-maps-fav">-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--</article>-->
                <!--<article id="documents-dashboard" class="tab-pane">-->
                <!--<div class="gd-content-body transparent top-bottom-margin-20px tab-pane">-->
                    <!--<div class="row">-->
                        <!--<div class="col-md-12">-->
                            <!--<div class="gd-content-body1 full-pad-40px1">-->
                              <!--<div id="gd-featurd-maps">-->
                                <!--<div class="block-separator"></div>-->
                                    <!--<div class="container">-->
                                        <!--<div class="gd-stastic">-->
                                            <!--<div class="gd-featurd-maps-content-dash">-->
                                                <!--<div id="dash-documents-fav" >-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--</article>-->
                <!--<article id="orgs-dashboard" class="tab-pane">-->
                <!--<div class="gd-content-body transparent top-bottom-margin-20px tab-pane">-->
                    <!--<div class="row">-->
                        <!--<div class="col-md-12">-->
                            <!--<div class="gd-content-body1 full-pad-40px">-->
                              <!--<div id="gd-featurd-maps" style="background:#fff;">-->
                                <!--<div class="block-separator"></div>-->
                                    <!--<div class="container">-->
                                        <!--<div class="gd-stastic">-->
                                            <!--<div class="gd-featurd-maps-content-dash" style="background:#fff;">-->
                                                <!--<div id="dash-org-fav">-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--</article>-->
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_script %}

  <script type="text/javascript">
    $(document).ready(function(){

        {% if site_wide_announcements %}
            $("#GDAnnouncementsModel").modal('show');
        {% endif %}

          var url = '{% url 'api_dispatch_list' api_name='api' resource_name='favoritelayers' %}';
          $.ajax({
            url: url,
            type: 'GET',
            data: {},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            context: document.body,
            success: function(jsondata){
                //console.log(JSON.stringify(jsondata));
                var data = eval(jsondata.objects);
                var t_count = '';
                    t_count = data.length;
                $("#total_layers-fav").text(t_count);
                var output = '';
                $.each(data, function(i, item) {
                    output += '<article class="gd-featurd-maps-container-dash">';
                    output +='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="grid-container-dash lmd" style="background:none;">';
                    output +='<div class="avater">';
                    output +='<div class="avater-img">';
                    output +='<div class="avater-img-mid"  >';
                                if(item.thumbnail_url)
                    output +='<img src="'+ item.thumbnail_url +'" alt="'+ item.title +'" class="group-logo" />';
                                else{
                    output +='<img src="\/static\/geonode\/img\/missing_thumb.png" alt="'+ item.title +'" class="group-logo" />';
                                }
                    output +='</div>';
                    output +='</div>';
                    output +='<div class="checkbox-overlay">';
                    output +='<div class="checkbox">';
                    output +='<label>';
                    output +='<span class="fa-stack fa-lg" >';
                    output +='<a href="#" title="Undock" id="undock" data-favouriteID="'+item.id+'" data-favouriteStatus="true" onclick="udock('+item.id+');"><i class="fa fa-times fa-stack-1x"></i></a>';
                    output +='</span>';
                    output +='</label>';
                    output +='</div>';
                    output +='</div>';
                    output +='</div>';
                    output +='<div class="contents">';
                    output +='<div class="title">';
                    output +='<a href="'+item.detail_url+'" title="'+ item.title  +'">';
                    if (item.title.length >= 25){
                    output +=''+item.title.slice(0,15)+'.....';
                            }else{
                    output +=''+ item.title +'';
                            }
                    output +='</a>';
                    output +='</div>';
                    output +='</div>';
                    output +='</div></div>';
                    output +='</article>';
               });
               $("#dash-layer-fav").append(output);
            }});
    });
  </script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#maps_dashboard").click(function(){
          var url = '{% url 'api_dispatch_list' api_name='api' resource_name='favoritemaps' %}';
          $.ajax({
            url: url,
            type: 'GET',
            data: {},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            context: document.body,
            success: function(jsondata){
                //console.log(JSON.stringify(jsondata));
                var data = eval(jsondata.objects);
                var t_count = data.length;
                $("#total_maps-fav").text(t_count);
                var output = '';
                $.each(data, function(i, item) {
                        output += '<article class="gd-featurd-maps-container-dash">';
                        output +='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="grid-container-dash lmd" style="background:none;">';
                        output +='<div class="avater">';
                        output +='<div class="avater-img">';
                        output +='<div class="avater-img-mid" >';
                                    if(item.thumbnail_url)
                        output +='<img src="'+ item.thumbnail_url +'" alt="" class="group-logo" />';
                                    else{
                        output +='<img src="\/static\/geonode\/img\/missing_thumb.png" alt="" class="group-logo" />';
                                    }
                        output +='</div>';
                        output +='</div>';
                        output +='<div class="checkbox-overlay">';
                        output +='<div class="checkbox">';
                        output +='<label>';
                        output +='<span class="fa-stack fa-lg" >';
                        output +='<a href="#" title="Undock" id="undock" data-favouriteID="'+item.id+'" data-favouriteStatus="true" onclick="udock('+item.id+');"><i class="fa fa-times fa-stack-1x"></i></a>';
                        output +='</span>';
                        output +='</label>';
                        output +='</div>';
                        output +='</div>';
                        output +='</div>';
                        output +='<div class="contents">';
                        output +='<div class="title">';
                        output +='<a href="'+item.detail_url+'" title="'+ item.title  +'">';
                        if (item.title.length >= 25){
                        output +=''+item.title.slice(0,15)+'.....';
                                }else{
                        output +=''+ item.title +'';
                                }
                        output +='</a>';
                        output +='</div>';
                        output +='</div>';
                        output +='</div></div>';
                        output +='</article>';
               });
               $("#dash-maps-fav").append(output);
            }});
            $("#maps_dashboard").unbind('click');
        });
    });
  </script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#documents_dashboard").click(function(){
          var url = '{% url 'api_dispatch_list' api_name='api' resource_name='favoritedocuments' %}';
          $.ajax({
            url: url,
            type: 'GET',
            data: {},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            context: document.body,
            success: function(jsondata){
                //console.log(JSON.stringify(jsondata));
                var data = eval(jsondata.objects);
                var t_count = data.length;
                $("#total_documents_fav").text(t_count);
                var output = '';
                $.each(data, function(i, item) {
                        output += '<article class="gd-featurd-maps-container-dash">';
                        output +='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="grid-container-dash lmd" style="background:none;">';
                        output +='<div class="avater">';
                        output +='<div class="avater-img">';
                        output +='<div class="avater-img-mid"  >';
                                    if(item.thumbnail_url)
                        output +='<img src="'+ item.thumbnail_url +'" alt="" class="group-logo" />';
                                    else{
                        output +='<img src="\/static\/geonode\/img\/missing_thumb.png" alt="" class="group-logo" />';
                                    }
                        output +='</div>';
                        output +='</div>';
                        output +='<div class="checkbox-overlay">';
                        output +='<div class="checkbox">';
                        output +='<label>';
                        output +='<span class="fa-stack fa-lg" >';
                        output +='<a href="#" title="Undock" id="undock" data-favouriteID="'+item.id+'" data-favouriteStatus="true" onclick="udock('+item.id+');"><i class="fa fa-times fa-stack-1x"></i></a>';
                        output +='</span>';
                        output +='</label>';
                        output +='</div>';
                        output +='</div>';
                        output +='</div>';
                        output +='<div class="contents">';
                        output +='<div class="title">';
                        output +='<a href="'+item.detail_url+'" title="'+ item.title  +'">';
                        if (item.title.length >= 25){
                        output +=''+item.title.slice(0,15)+'.....';
                                }else{
                        output +=''+ item.title +'';
                                }
                        output +='</a>';
                        output +='</div>';
                        output +='</div>';
                        output +='</div></div>';
                        output +='</article>';
               });
               $("#dash-documents-fav").append(output);
            }});
            $("#documents_dashboard").unbind('click');
        });
    });
  </script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#orgs_dashboard").click(function(){
          var url = '{% url 'api_dispatch_list' api_name='api' resource_name='favoritegroups' %}';
          $.ajax({
            cache: false,
            url: url,
            type: 'GET',
            data: {},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            context: document.body,
            success: function(jsondata){
                //console.log(JSON.stringify(jsondata));
                var data = eval(jsondata.objects);
                var t_count = data.length;
                $("#total_org-fav").text(t_count);
                var output = '';
                $.each(data, function(i, item) {
                        output += '<article class="gd-featurd-maps-container-dash">';
                        output +='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="grid-container-dash lmd" style="background:none;">';
                        output +='<div class="avater">';
                        output +='<div class="avater-img">';
                        output +='<div class="avater-img-mid"  >';
                                    if(item.logo)
                        output +='<img src="'+ item.logo +'" alt="" class="group-logo img-responsive" />';
                                    else{
                        output +='<img src="\/static\/geonode\/img\/missing_thumb.png" alt="" class="group-logo img-responsive" />';
                                    }
                        output +='</div>';
                        output +='</div>';
                        output +='<div class="checkbox-overlay">';
                        output +='<div class="checkbox">';
                        output +='<label>';
                        output +='<span class="fa-stack fa-lg" >';
                        output +='<a href="javascript:;" title="Undock" id="undock" data-favouriteID="'+item.id+'" data-favouriteStatus="true" onclick="udockorg('+item.id+');"><i class="fa fa-times fa-stack-1x"></i></a>';
                        output +='</span>';
                        output +='</label>';
                        output +='</div>';
                        output +='</div>';
                        output +='</div>';
                        output +='<div class="contents">';
                        output +='<div class="title">';
                        output +='<a href="'+item.detail_url+'" title="'+ item.title  +'">';
                        if (item.title.length >= 25){
                        output +=''+item.title.slice(0,15)+'.....';
                                }else{
                        output +=''+ item.title +'';
                                }
                        output +='</a>';
                        output +='</div>';
                        output +='</div>';
                        output +='</div></div>';
                        output +='</article>';
               });
               $("#dash-org-fav").append(output);
            }});
            $("#orgs_dashboard").unbind('click');
        });
    });
  </script>

  <script type="text/javascript" language="JavaScript">

        function udock(undockID){
        //var make_favoriteStatus = undockStatus;
        //alert(data_favouriteID+data_favouriteStatus);
        //alert("Are you sure make this as undock ?");
            var url = '{% url 'api_dispatch_list' api_name='api' resource_name='undockit' %}';
               var makefavoriteID = undockID;
                var data = JSON.stringify({
                "resource_id": makefavoriteID
            });
            $.ajax({
                cache: false,
                type: 'POST',
                url: url,
                data: data,
                dataType: "json",
                success: function(jsondata) {
                    console.log("success");
                    //console.log(JSON.stringify(jsondata));
                    //location.reload(true);

                    var data = eval(jsondata.objects);
                        window.location.href = data;
                        window.location.reload();

                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log("error");
                }
             });
        }
    </script>
    <script type="text/javascript" language="JavaScript">

        function udockorg(undockID){
        //var make_favoriteStatus = undockStatus;
        //alert(undockID);
        //alert("Are you sure make this as undock ?");
            var url = '{% url 'api_dispatch_list' api_name='api' resource_name='undockit' %}';
               var makefavoriteID = undockID;
               //var makefavoritesID = make_favoriteStatus;
                var data = JSON.stringify({
                "group_id": makefavoriteID
            });
            $.ajax({
                cache: false,
                type: 'POST',
                url: url,
                data: data,
                dataType: "json",
                success: function(jsondata) {
                    console.log("success");
                    //console.log(JSON.stringify(jsondata));
                    //location.reload(true);

                    var data = eval(jsondata.objects);
                        window.location.href = data;
                        window.location.reload();

                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log("error");
                }
             });
        }
    </script>

{% endblock extra_script %}