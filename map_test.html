<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>OpenLayers Boxes Example</title>
        <link rel="stylesheet" href="theme/default/style.css" type="text/css">
        <link rel="stylesheet" href="style.css" type="text/css">
        <script src="http://dev.openlayers.org/OpenLayers.js"></script>
        <script type="text/javascript">
        var x = {
        "layers": [{
            "opacity": 1,
            "group": "background",
            "args": ["No background"],
            "visibility": false,
            "source": "0",
            "fixed": true,
            "type": "OpenLayers.Layer"
        }, {
            "opacity": 1,
            "group": "background",
            "name": "mapnik",
            "visibility": false,
            "source": "1",
            "fixed": true,
            "type": "OpenLayers.Layer.OSM"
        }, {
            "opacity": 1,
            "group": "background",
            "name": "osm",
            "visibility": true,
            "source": "2",
            "fixed": false
        }, {
            "opacity": 1,
            "group": "background",
            "name": "naip",
            "visibility": false,
            "source": "2",
            "fixed": false
        }, {
            "opacity": 1,
            "group": "background",
            "name": "AerialWithLabels",
            "visibility": false,
            "source": "3",
            "fixed": true
        }, {
            "opacity": 1,
            "source": "4",
            "fixed": false,
            "visibility": true
        }, {
            "opacity": 1.0,
            "name": "geonode:index",
            "title": "index",
            "selected": true,
            "visibility": true,
            "srs": "EPSG:900913",
            "bbox": [13825393.814371249, 807566.643619642, 13852644.846474735, 817795.469341697],
            "getFeatureInfo": {
                "fields": ["GRID_REF", "MINX", "MINY", "MAXX", "MAXY", "Tilename", "File_Path"],
                "propertyNames": {
                    "MAXX": null,
                    "MAXY": null,
                    "GRID_REF": null,
                    "Tilename": null,
                    "MINX": null,
                    "MINY": null,
                    "File_Path": null
                }
            },
            "fixed": false,
            "queryable": true,
            "source": "5"
        }],
        "center": [0.0, -7.081154550627918e-10],
        "units": "m",
        "maxResolution": 156543.03390625,
        "maxExtent": [-20037508.34, -20037508.34, 20037508.34, 20037508.34],
        "zoom": 0,
        "projection": "EPSG:900913"
    }
        var box_extents = [
                [-10, 50, 5, 60],
                [-75, 41, -71, 44],
                [-122.6, 37.6, -122.3, 37.9],
                [10, 10, 20, 20]
            ];
            var map;
            function init(){
                map = new OpenLayers.Map('map');

                //var ol_wms = new OpenLayers.Layer.WMS( "OpenLayers WMS",
                //    "http://vmap0.tiles.osgeo.org/wms/vmap0?", {layers: 'basic'} );
                
                console.log("Number of layers:" + map.getNumLayers());
                
                var feature_layer  = new OpenLayers.Layer.Vector( "Feature Layer" );
                map.addLayer(feature_layer);
                
                OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {
                            defaultHandlerOptions: {
                                "single": true,
                                "double": false,
                                "pixelTolerance": 0,
                                "stopSingle": false,
                                "stopDouble": false
                            },
        
                            initialize: function(options) {
                                this.handlerOptions = OpenLayers.Util.extend(
                                    {}, this.defaultHandlerOptions
                                );
                                OpenLayers.Control.prototype.initialize.apply(this, arguments); 
                                    this.handler = new OpenLayers.Handler.Click(
                                        this, {
                                            'click': this.trigger
                                        }, this.handlerOptions
                                    );
                            },
        
                            trigger: function(e) {
                                var point = map.getLonLatFromPixel(e.xy);
                                var style = {
                                    fillColor: "#00000ff",
                                    fillOpacity: 0.2,
                                    stroke: true,
                                    strokeColor: "#000000",
                                };
                                
                                var test_ext = [ 20, 30, 40, 50 ];
                                var p1 = new OpenLayers.Geometry.Point(-154,64)
                                var p2 = new OpenLayers.Geometry.Point(-154,67)
                                var p3 = new OpenLayers.Geometry.Point(-150,67)
                                var p4 = new OpenLayers.Geometry.Point(-150,65)
                                var points = [];
                                points.push(p1);
                                points.push(p2);
                                points.push(p3);
                                points.push(p4);
                                var poly = new OpenLayers.Geometry.LinearRing(points);
                                var vec = new OpenLayers.Feature.Vector(poly, null);
                                feature_layer.addFeatures([vec]);
                                //tile_select_layer.setMap(map);
                                //var test_bounds = OpenLayers.Bounds.fromArray(test_ext);
                                //var test_box = new OpenLayers.Marker.Box(test_bounds);
                                //boxes.addMarker(test_box);
                                //if (boxes.redraw()){
                                //    console.log("Layer was redrawn.");
                                //}
                            }
                                
                        });
            
                        click_select = new OpenLayers.Control.Click()
                        map.addControl(click_select);   
                        click_select.activate();

                map.addLayers([ol_wms, x["layers"]);
                map.addControl(new OpenLayers.Control.LayerSwitcher());
                map.zoomToMaxExtent();
            }
        </script>
    </head>
    <body onload="init()">
        <h1 id="title"> Test</h1>
        
        <div id="map" class="smallmap"></div>
    </body>
