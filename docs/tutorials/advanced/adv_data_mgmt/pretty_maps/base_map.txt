.. _geoserver.base_map:

Creating a Base Map with a Layer Group
--------------------------------------

The best way to easily set-up a map with more than one layer for consumption is to create a `Layer Group`, that is what we are going to do in this section.

#. Locate the :guilabel:`Layer Group` link and click it.

   .. figure:: img/group1.png
      :height: 500

      Layer Group link

#. Click the :guilabel:`Add new layer group` link.

   .. figure:: img/group2.png

      Add new layer group link

#. Name it ``test``. 

   .. figure:: img/group3-1.png

#. Click the `Add layer` link:
	  
   .. figure:: img/group3-2.png

      Add new layer

#. Select the "Mainrd" layer in the popup window.

   .. figure:: img/group4.png

      Select a layer

#. Add also "BoulderCityLimits" and "bplandmarks", the final list should look like this:.

   .. figure:: img/group5.png

      List of layers for the group

   .. note:: You can use the green arrows to adjust the ordering of the layers until it looks like the above figure.

#. Click the generate bounds button to have GeoServer compute the group bounds from the layers inside of it:

#. Scroll to the bottom of the page and then click :guilabel:`Save`.

#. If all went well, you should see something like this:

   .. figure:: img/group7.png

      After a successful save.

	 .. note:: The autogenerated bounds may be too large and you may experience a bad feeling when previewing the map. You can optionally reduce the layer group bounds by inserting manually the bbox values. Good values are the following:
	           minx = 3.057.566,8646; maxx = 3.079.500,65246; miny = 1.241.929,35617; maxy = 1.257.467,5777

The layer group is now ready to be consumed:

#. Navigate to the GeoServer `Welcome Page <http://localhost:8083/geoserver/web/>`_.

#. Go to the :guilabel:`Layer Preview` link at the bottom of the left-hand menu.
 
   .. figure:: img/preview1.png

      Layer Preview

#. Find the `test` layer group and click on the :guilabel:`OpenLayers` link. You will see a slippy map with all the configured layers of the Boulder district. You can control zoom by using the mouse wheel, pan by dragging, and zoom by window holding ``SHIFT`` pressed while dragging.

   .. figure:: img/preview3.png

      OpenLayers view

   .. note:: Check the browser's address bar for an interesting sample WMS request for the layer.
      
#. As you might have noticed before, a larger, more realistic group has already been configured for you. It is named ``boulder``. Have a look at its definition and add to this the `Mainrd` layer. Then using the green arrows move the layer at the following position (see the screenshot).

   .. figure:: img/preview3b.png

      A new layer inside the existing layer group.
	  
#. Then use the Map Preview to display it.

#. Try clicking in the middle of the map. A couple of tables with more information about the vector features that have been clicked should appear at the bottom.
   
   .. figure:: img/preview4.png

      Feature info

#. Try zooming in more and more. New layers should start to appear. This is scale dependent styling.

Now let's see how desktop clients handle the layer group, and how we can change the way the see it.

#. Go to the command line, enter the workshop directory, if you haven't done that yet, run ``setenv.bat`` and then ``udig.bat``

#. Once both GeoServer and uDig are up, organize their Windows so that you can see GeoServer and uDig ones at the same time

#. Now go to the GeoServer home page, where all the capabilities links are kept, take the WMS 1.1.1 one, and drag&drop it into uDig "Catalog" tab to import the WMS as a uDig data source:

   .. figure:: img/group8.png

#. Look at the layer tree. The ``boulder`` group is visible as a simple layer, and all the layers it contains are actually shown at the same level as the group.

   .. figure:: img/group9.png

#. Let's change it so that the layer group internal structure is shown. Go back to the "boulder" layer group page, and change its "mode" to "Named tree", then press the "Save" button

   .. figure:: img/group10.png

#. We need to make uDig aware of the change. Right click the root of the capabilities tree and choose the "Reset" command

   .. figure:: img/group11.png

#. Now most of the layers are contained inside the "boulder" group

   .. figure:: img/group12.png 
