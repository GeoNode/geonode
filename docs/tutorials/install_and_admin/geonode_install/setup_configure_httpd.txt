.. _setup_configure_httpd:

==========
Web Server
==========
There are many web servers out there. Apache is probably the most popular, but weâ€™ve found that Nginx adapts itself much better to limited resource environments. A guide how to use it instead of Apache will be added.

Apache Configuration
====================
Navigate to Apache configurations folder

.. code-block:: bash

    cd /etc/apache2/sites-available

And create a new configuration file for GeoNode:

.. code-block:: bash

    sudo vim geonode.conf

Place the following content inside the file

.. code-block:: yaml

    WSGIDaemonProcess geonode python-path=/home/geonode/my_geonode:/home/geonode/.venv/my_geonode/lib/python2.7/site-packages user=www-data threads=15 processes=2

    <VirtualHost *:80>
        ServerName http://localhost
        ServerAdmin webmaster@localhost
        DocumentRoot /home/geonode/my_geonode/my_geonode

        LimitRequestFieldSize 32760
        LimitRequestLine 32760

        ErrorLog /var/log/apache2/error.log
        LogLevel warn
        CustomLog /var/log/apache2/access.log combined

        WSGIProcessGroup geonode
        WSGIPassAuthorization On
        WSGIScriptAlias / /home/geonode/my_geonode/my_geonode/wsgi.py

        Alias /static/ /home/geonode/my_geonode/my_geonode/static_root/
        Alias /uploaded/ /home/geonode/my_geonode/my_geonode/uploaded/

        <Directory "/home/geonode/my_geonode/my_geonode/">
             <Files wsgi.py>
                 Order deny,allow
                 Allow from all
                 Require all granted
             </Files>

            Order allow,deny
            Options Indexes FollowSymLinks
            Allow from all
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/static_root/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Allow from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/uploaded/thumbs/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Allow from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/uploaded/avatars/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Allow from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/uploaded/people_group/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Allow from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/uploaded/group/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Allow from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/uploaded/documents/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Deny from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Directory "/home/geonode/my_geonode/my_geonode/uploaded/layers/">
            Order allow,deny
            Options Indexes FollowSymLinks
            Deny from all
            Require all granted
            IndexOptions FancyIndexing
        </Directory>

        <Proxy *>
            Order allow,deny
            Allow from all
        </Proxy>

        ProxyPreserveHost On
        ProxyPass /geoserver http://127.0.0.1:8080/geoserver
        ProxyPassReverse /geoserver http://127.0.0.1:8080/geoserver

    </VirtualHost>

This sets up a VirtualHost in Apache HTTP server for GeoNode and a reverse proxy
for GeoServer.

.. note::

    In the case that GeoServer is running on a separate machine change the `ProxyPass`
    and `ProxyPassReverse` accordingly

Now load apache `poxy` module

.. code-block:: bash

    sudo a2enmod proxy_http

And enable geonode configuration file

.. code-block:: bash

    sudo a2ensite geonode
    suudo a2dissite 000-default
    sudo service apache2 restart

NGINX Configuration
===================

TBD.

