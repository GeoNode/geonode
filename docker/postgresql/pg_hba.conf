# Local Unix socket connections - trust for local admin access
local   all             postgres                                trust

# Localhost connections - trust for container internal access
host    all             postgres        127.0.0.1/32            trust
host    all             postgres        ::1/128                 trust

# Allow replication connections from localhost
local   replication     all                                     trust
host    replication     all             127.0.0.1/32            trust
host    replication     all             ::1/128                 trust

# =============================================================================
# Application-specific rules (evaluated in order)
# =============================================================================

# GeoNode database - require SCRAM-SHA-256 authentication
# This matches connections from Django/Celery containers
host    geonode         geonode         172.19.0.0/16           scram-sha-256

# GeoNode geodatabase - require SCRAM-SHA-256 authentication
# This matches connections from GeoServer
host    geonode_data    geonode_data    172.19.0.0/16           scram-sha-256

# Template databases - no external access allowed
host    template0       all             all                     reject
host    template1       all             all                     reject

# Postgres database - admin only, require password
host    postgres        postgres        172.19.0.0/16           scram-sha-256

# =============================================================================
# Default catch-all rule - deny all other connections
# =============================================================================
# Uncomment to explicitly deny all other connections:
# host    all             all             all                     reject

# Or allow with password (current default):
host    all             all             all                     scram-sha-256
