{% extends "page_layout.html" %}
{% load i18n %}
{% load navbar %}

{% block title %} {% trans "Replace AME Data" %} - {{ block.super }} {% endblock %}

{% block head %}
{% include "geonode/ext_header.html" %}
{% include "geonode/openlayers_header.html" %}
{% include "geonode/geoext_header.html" %}
{% include "geonode/ux_header.html" %}
{% include "geonode/gxp_header.html" %}
{{ block.super }}
{% endblock %}

{% block main %}

  <div id="upload_form">
  </div>

<script type="text/javascript">
Ext.onReady(function(){
  
  var form_target = "{% url capra.files.views.dispatch file.id %}?update"

  var base_file = new Ext.ux.form.FileUploadField({
      id: 'ame_file',
      emptyText: gettext('Select an AME data file'),
      fieldLabel: gettext('File'),
      name: 'file',
      allowBlank: false
  });

  var title_input = new Ext.form.TextField({
    id: 'title',
    name: 'title',
    fieldLabel: gettext('Title'),
    emptyText: gettext('If no title is given, the filename is used. (optional)'),
    allowBlank: true, 
  });

  var fp = new Ext.FormPanel({
    renderTo: 'upload_form',
    fileUpload: true,
    width: 500,
    frame: true,
    title: gettext('Update AME Data'),
    autoHeight: true,
    bodyStyle: 'padding: 10px 10px 0 10px;',
    labelWidth: 50,
    defaults: {
        anchor: '95%',
        msgTarget: 'side'
    },
    items: [base_file, title_input],
    buttons: [{
        text: gettext('Upload'),
        handler: function(){
            if(fp.getForm().isValid()) {
              fp.getForm().submit({
                  submitEmptyText: false,
                  url: form_target,
                  waitMsg: gettext('Uploading your data...'),
                  success: function(fp, o) {
                      document.location = o.result.redirect_to;
                  },
                  failure: function(fp, o) {
                      error_message = '<ul>';
                      for (var i = 0; i < o.result.errors.length; i++) {
                          error_message += '<li>' + o.result.errors[i] + '</li>'
                      }
                      error_message += '</ul>'
                      
                      Ext.Msg.show({
                          title: gettext("Error"),
                          msg: error_message,
                          minWidth: 200,
                          modal: true,
                          icon: Ext.Msg.ERROR,
                          buttons: Ext.Msg.OK
                      });
                  }
                  
              });
            }
          }
      }]
    });
  });
</script>
{% endblock %}

{% block sidebar %}
{% blocktrans with file.filename as filename %}
<h3>Instructions</h3>
<p>This form allows you to replace the AME file {{filename}}</p>
<h3>Warning</h3>
<p>The current file will no longer be available after submitting this form.</p>
{% endblocktrans %}

<p><a href="{% url capra.files.views.dispatch file.id %}">
  {% trans "Return to viewing details"  %}
</a></p>

{% endblock %}
